# NextPass（ResumeCreater）

iPhone・Android・Windows上でオフライン完結で履歴書・職務経歴書を作成しPDF出力するPWAアプリ。  
基本情報を一度入力すれば保存され、応募先ごとに志望動機等のみ切り替えて即座にPDF生成が可能。

## 技術構成

| 項目 | 技術 |
|------|------|
| アプリ形式 | PWA（Progressive Web App） |
| フロントエンド | HTML / CSS / JavaScript（フレームワーク不使用） |
| PDF生成 | jsPDF 2.5.1 + html2canvas 1.4.1（CDN） |
| データ保存 | IndexedDB |
| 設定保存 | localStorage（アドバンストモード設定） |
| ホスティング | GitHub Pages（HTTPS） |
| オフライン | Service Worker |

## 主な機能

- **履歴書・職務経歴書のPDF生成**: JIS規格風レイアウトで計4ページ（履歴書2P + 職務経歴書2P）を出力
- **データ保存・自動復元**: IndexedDB に個人情報・学歴・職歴・資格を保存し、次回起動時に自動読み込み
- **応募先セット管理**: 企業ごとに志望動機・自己PR・提出日を保存。切替えるだけで新しい書類が完成
- **応募先コピー機能**: 既存の応募先データを複製して効率的に管理
- **年齢自動計算**: 生年月日と提出日から満年齢を自動算出
- **証明写真対応**: カメラ撮影またはファイル選択でアップロード。掲載ON/OFFチェックボックス付き
- **性別欄**: 「未記載」「男」「女」のドロップダウン選択（任意記載）
- **空白行自動調整**: 学歴・職歴・資格の入力数に応じて空白行を自動調整し、2ページに収める
- **アドバンストモード**: 履歴書P1/P2の学歴・職歴行数、資格行数を手動で指定可能。超過時に警告表示
- **応募先別業務内容**: 職務経歴の業務内容・成果を応募先ごとにカスタマイズ可能。未設定時は職務経歴タブのデフォルト値を使用
- **データバックアップ**: JSON形式でのエクスポート/インポートに対応
- **完全オフライン動作**: Service Worker により初回アクセス後はインターネット不要
- **マルチプラットフォーム**: iPhone・Android・Windows で「ホーム画面に追加」でネイティブアプリ風に動作
- **モバイル対応**: レスポンシブデザインでスマートフォンでもプレビュー・操作可能
- **リセット機能**: 全データ一括削除（二段階確認付き）

## ファイル構成

```
ResumeCreater/
├── index.html          … SPA エントリーポイント
├── manifest.json       … PWA マニフェスト
├── sw.js               … Service Worker（オフラインキャッシュ）
├── css/
│   └── style.css       … スタイル（A4レイアウト・フォーム・レスポンシブ）
├── js/
│   ├── utils.js        … ユーティリティ（日付計算・エスケープ・Toast等）
│   ├── db.js           … IndexedDB アクセス層
│   ├── templates.js    … 履歴書・職務経歴書 HTMLテンプレート生成
│   ├── pdf-generator.js … PDF生成処理（jsPDF + html2canvas）
│   └── app.js          … メインロジック・UI制御・タブ切替・イベント管理
├── assets/icons/       … PWA アイコン（192px / 512px）
├── doc/
│   └── README.md       … 本ドキュメント
└── sample/             … サンプルデータ
```

## 使用方法

### 初回
1. GitHub Pages の URL にブラウザでアクセス
2. 「ホーム画面に追加」または「アプリとしてインストール」
3. 基本情報・学歴・職歴・資格を入力（自動保存）
4. 応募先を作成し、提出日・志望動機・自己PRを入力
5. プレビューで確認 → PDF保存

### 2回目以降
1. アプリを開く（基本情報は自動復元済み）
2. 応募先管理で「新規作成」→ 企業名・提出日・志望動機を入力
3. プレビュー → PDF保存

### アドバンストモード
1. プレビュー画面で「アドバンストモード」チェックボックスをON
2. 各行数（履歴書P1学歴・職歴行数 / P2行数 / 資格行数）を手動設定
3. 入力データが設定行数を超える場合は黄色の警告バナーが表示される
4. 設定はlocalStorageに保存され、次回起動時に復元される

## システム要件

- **iPhone**: Safari（iOS 14以降推奨）
- **Android**: Chrome（Android 8以降推奨）
- **Windows**: Chrome または Edge
- 初回のみインターネット接続が必要（以降はオフライン動作）

## 変更履歴

### v20 — モバイルプレビューPC一致・改ページ実行順修正
- **モバイルプレビューのPC一致**: モバイルCSS`@media (max-width: 768px)`でA4ページに`border: 1px solid #ccc`を適用していたことで`box-sizing: border-box`によりコンテンツ領域が2px縮小し、テキスト折り返しがPCと異なっていた問題を修正。`outline`（レイアウト不変）に変更し、`width`/`height`/`font-size`の冗長な上書きを削除
- **text-size-adjust追加**: `.a4-page`に`-webkit-text-size-adjust: 100%`を設定し、モバイルブラウザの自動テキストサイズ調整を防止
- **scalePreviewPages改善**: ハードコードされたA4サイズ定数（793.7px/1122.5px）から`offsetWidth/offsetHeight`による実測値に変更。各ページの実際のサイズからスケール率を算出
- **Service Worker**: キャッシュバージョンを v20 に更新

### v19 — 改ページ統合バグ修正・アドバンストモード初期値リセット・タイトルアイコン修正
- **改ページ統合の実行順修正**: `adjustCareerOverflow`内で、3ページ警告(`alert()`)がtry-and-see統合より前に実行されていたバグを修正。統合→ページ番号更新→警告の正しい順序に変更し、統合によりページ数が減る場合に不要な警告が出なくなった
- **アドバンストモード初期値リセット**: プレビュー画面のアドバンストモードパネルに「初期値に戻す」ボタンを追加。クリックで行数設定を`DEFAULT_OPTIONS`（P1:16行/P2:3行/資格:3行）に戻す
- **タイトルアイコン修正**: ヘッダーの📄絵文字をアプリアイコン画像（`<img>`タグ）に置換。24px角のアイコンをタイトル左に表示
- **Service Worker**: キャッシュバージョンを v19 に更新

### v18 — アプリ名「NextPass」・URLエラー修正・入力画面警告・改ページ統合改善
- **アプリ名変更**: 「職務経歴書ジェネレーター」→「NextPass」に変更（タイトル・manifest.json・PWA名）
- **favicon追加**: `<link rel="icon">` を追加し、ブラウザタブにアイコンを表示
- **URLエラー修正**: 応募先フォーム内の削除・移動ボタンに`type="button"`を追加し意図しないフォーム送信を防止。`form submit`イベントも`preventDefault`でブロック
- **入力画面で3ページ警告**: 職務経歴タブでの編集時にもページ数チェックを実行。3ページ以上になった場合に入力画面でも`alert()`ダイアログを表示
- **改ページ統合改善**: try-and-see方式に変更。page2の内容を一時的に最終職歴ページに移動し、溢れがあれば戻す方式で確実に統合判定
- **インポートアイコン修正**: 破損していた絵文字をHTMLエンティティ（`&#x1F4C2;`）に置換
- **Service Worker強化**: GETリクエストのみキャッシュ、URL長制限(2048)、try-catch追加。キャッシュバージョン v16

### v17 — 応募先別業務内容・改ページ統合修正・アプリ名変更
- **アプリ名変更**: 「履歴書メーカー」→「職務経歴書ジェネレーター」に変更（タイトル・manifest.json・PWA名）
- **応募先別業務内容・成果**: 職務経歴の業務内容・工夫・成果を応募先ごとにカスタマイズ可能に。未設定時は職務経歴タブのデフォルト値を使用
- **職務経歴書の改ページ統合修正**: `adjustCareerOverflow` の早期リターンバグを修正。資格・スキル・志望動機セクションが最終職歴ページに余白があれば同ページに統合されるように
- **3ページ警告ダイアログ**: 職務経歴書が3ページ以上になった場合、Toastに加えて`alert()`ダイアログで警告表示
- **電話/メール区切り線左端修正**: `.contact-phone-row`に`margin-left: -1.5mm`を追加し、両端がセル端まで延長
- **インポート/エクスポートアイコン変更**: インポート=📂、エクスポート=💾
- **showToast改善**: `duration`パラメータ（3引数目）を追加、デフォルト2500ms
- **Service Worker**: キャッシュバージョンを v15 に更新

### v16 — 太線結合修正・電話区切り線延長
- **birth-table上罫線フル幅修正**: name-tableのセル下罫線を削除し、birth-tableの`border-top: 2px`のみで結合部の水平線を提供。サンプルと同じフル幅の太線を実現
- **name-tableの結合方式変更**: `border-bottom: none`（テーブル外枠）+ 最終行セルの`border-bottom: none`で二重線を完全に解消
- **電話/メール区切り線の右端延長**: `.contact-phone-row`に`margin-right: -1.5mm`を追加し、セル右端まで区切り線を延長
- **Service Worker**: キャッシュバージョンを v14 に更新

### v15 — 写真枠サンプル完全一致・以上削除・現在に至る左寄せ
- **写真枠の位置・サイズをサンプルに完全一致**: 高さ23.2mm → 35mmに変更、`position: absolute; top: -13.1mm; left: 6mm;` でタイトル行までの拡張配置
  - サンプル画像とのPlaywright計測: top diff +0.04mm, left diff -0.11mm, サイズ完全一致
- **写真枠のposition変更**: `position: relative` → `position: absolute`、photo-cellに `position: relative` を追加
- **「以上」行を削除**: 履歴書の学歴・職歴テーブルから「以上」行を完全に削除
- **「現在に至る」左寄せ**: `text-align: right` → `text-align: left; padding-left: 2mm;` に変更
- **性別セル上部の二重線修正**: `.resume-birth-table td` に `border-top: none` を追加し、name-tableとbirth-tableの結合部分の二重線を解消
- **Service Worker**: キャッシュバージョンを v13 に更新
- **ドキュメント更新**: copilot-instructions.md / SPEC.md / README.md を最新仕様に同期

### v14 — サンプル完全一致・レイアウト精密修正・自動判定機能追加
- **写真ボックス位置修正**: `position: relative; top: -1.35mm` でテーブル上端と完全一致（diff=+0.00mm）
  - `margin-top` は `border-collapse` テーブルセル内で無効のため `position: relative` を採用
- **写真ボックスサイズ修正**: 高さを23mm → 23.2mmに変更（サンプルとdiff=-0.01mm）
- **縦線太さ修正**: 写真セル・性別セル・連絡先セルの左罫線を1px → 2pxに変更
  - サンプルのx=151.5mm位置の連続太線と完全一致
- **「現在に至る」自動判定**: 最終職歴が退社/退職でない場合、「現在に至る」を「以上」の前に自動挿入
- **職歴ブロック間の空白削除**: `career-block` のmargin-bottomを12px → 0に変更（隙間なし表示）
- **ページ溢れ判定条件**: 許容値を3px → 1pxに変更（より厳密な判定）
- **3ページ以上警告**: 職務経歴書が3ページ以上になった場合にToast警告を表示
- **資格セクション同ページ統合**: 最終職歴ページに余白が十分にあれば、資格・スキル・志望動機を同ページに統合
- **SPEC.md更新**: ページ溢れ処理の仕様を詳細に記載
- **copilot-instructions.md更新**: 新ルールを反映
- **Service Worker**: キャッシュバージョンを v12 に更新

### v9 — サンプル画像完全一致・テーブル構造修正
- **履歴書テーブル構造修正**: 写真セルを氏名テーブル内に統合し、全テーブル幅を184mm（A4コンテンツ幅）に統一
  - 写真セルを独立divからテーブルcellに変更（フレックスレイアウト廃止）
  - 性別セルを生年月日テーブルに移動（サンプル構造準拠）
  - ラベルセル幅: 20mm、右カラム幅: 46mm で全テーブル列位置を統一
- **履歴書フォントサイズ修正**:
  - タイトル「履歴書」: 20pt → 22pt（サンプル準拠）
  - 氏名: 14pt → 16pt
  - 学歴・職歴テーブル: 9.5pt → 10pt
  - 年/月カラム幅: 60px/40px → 20mm/14mm
- **履歴書ページ2「スカスカ」解消**: Flexboxレイアウト導入
  - `.resume-page` に `display: flex; flex-direction: column` 追加
  - 志望動機セクション `flex: 1` で残りスペースを自動充填
  - ページ1の学歴・職歴テーブルも `flex: 1` で残り高さに自動拡張
  - `.a4-page` を `height: 297mm` 固定（`min-height` から変更）
- **職務経歴書罫線修正**: キャリアブロック統一ボーダー構造
  - `.career-block` に `border: 1px solid #000` の外枠を追加
  - 期間ヘッダー・企業情報テーブル・職務内容テーブルの外枠を削除し内部仕切りのみに
  - 期間カラム幅: 70px → 24mm（サンプル準拠）
  - 期間ヘッダーに背景色 `#f9f9f9` 追加
- **派遣フォーム簡素化**: チェック時に会社名ラベルが「派遣会社名（派遣元）」に切替
  - 派遣元入力欄を廃止し会社名フィールドを兼用
  - 派遣チェック時は会社名+派遣先の2フィールド構成
- **ページ番号**: 右マージン11mm適用（コンテンツ領域内に収まるよう修正）
- **PDF出力テスト**: Playwright+pdfplumber による自動テスト実施
- **Service Worker**: キャッシュバージョンを v9 に更新

### v8 — サンプル完全一致・職務経歴書レイアウト再構築
- **職務経歴書テンプレート再構築**: サンプルPDFの構造を解析し、期間＋職務内容のテーブルレイアウトを導入
  - 左カラム（期間）+ 右カラム（部署・業務内容・成果）の2カラム構造
  - 企業情報テーブルと期間テーブルを罫線で接続
- **フォントサイズ修正**: サンプルPDF解析に基づき正確なサイズに調整
  - 職務経歴書タイトル: 18pt → 14pt
  - 本文: 10.5pt → 10pt
  - 「以上」: 10.5pt → 9pt
- **罫線修正**: 職務経歴書の全テーブル罫線を1px（細線）に統一
- **余白修正**: 履歴書と職務経歴書でサンプル通りの異なる余白を設定
  - 履歴書: 14mm上 / 13mm左右 / 16mm下
  - 職務経歴書: 18mm上 / 20mm左 / 11mm右 / 19mm下
- **ページ番号**: 履歴書は非表示、職務経歴書のみ右寄せで表示（サンプル準拠）
- **「以上」**: 9pt・右寄せ（サンプル準拠）
- **派遣表記修正**: 期間ヘッダーに「派遣先：xxx/ 派遣元：yyy」形式で表示
- **派遣フォーム改善**: チェックボックスを会社名直下に移動、ラベルを「派遣先企業名（派遣の場合）」に変更
- **企業情報テーブル比率**: 85%/15%に調整（サンプル準拠）
- **Service Worker**: キャッシュバージョンを v8 に更新

### v7 — ページ番号・JIS罫線・スマホプレビュー修正
- **ページ番号**: 文書別カウントに修正（履歴書 1/2, 2/2 / 職務経歴書 1/2, 2/2）
- **JIS罫線調整**: 期間ヘッダー・企業情報テーブル・資格テーブルの罫線修正
- **「以上」位置修正**: ページ番号の前に配置
- **スマホプレビュー**: 重なり防止のためスケーリング計算修正、resize/orientationchangeリスナー追加

### v6 — ページ番号・派遣対応・JIS準拠
- **ページ番号追加**: 全4ページにページ番号フッターを追加
- **JIS準拠**: 外枠2px・内枠1px・フォントサイズ調整
- **派遣チェックボックス追加**: 職務経歴入力に「派遣として勤務」チェックボックスと派遣先/元フィールドを追加
- **スマホプレビュー**: JS によるスケーリング機能を追加

### v5 — UI改善・並び替え機能
- **チェックボックスCSS修正**: チェックボックスの表示を修正
- **全リスト並び替え**: 学歴・資格・職務経歴・スキルに上下ボタンを追加
- **セパレータ行高さ修正**: 学歴・職歴間の空白行高さを統一
- **JIS罫線色修正**: 罫線色を #333 → #000 に変更

### v4 — レイアウト修正・アドバンストモード追加
- **写真重なり修正**: 履歴書ヘッダーをFlex配置に変更し、写真と本文の重なりを解消
- **性別セル修正**: 氏名テーブル内に性別セルを正しく表示
- **資格表幅修正**: 職務経歴書の資格テーブルを`width: 100%`に修正
- **ページ番号削除**: 職務経歴書の「1/2」「2/2」表示を削除
- **空白行自動調整**: 入力データ量に応じて空白行数を自動計算し2ページに収める
- **アドバンストモード**: プレビュー画面に行数手動設定パネルを追加。超過時の警告表示付き
- **モバイルプレビュー**: スマートフォンでのプレビュー表示幅・フォントサイズを最適化
- **Service Worker**: キャッシュバージョンを v4 に更新

### v3 — 機能拡充
- 職務経歴入力UIを編集可能カードに変更
- タブナビをスティッキーに変更
- テキストをtext-align: justifyに変更
- 写真掲載ON/OFFチェックボックス追加
- リセットボタン追加（二段階確認付き）
- エクスポート/インポートをJSON形式のみに統一
- スキル削除時の不具合修正
- 月表示を2桁ゼロ埋めに統一

### v2 — 基本改善
- 性別欄をテキスト入力からドロップダウンに変更
- jsPDF CDNリンク修正（cdnjs版に統一）

### v1 — 初版リリース
- 履歴書・職務経歴書4ページPDF生成
- IndexedDBによるデータ保存
- 応募先セット管理
- 証明写真アップロード
- Service Workerによるオフライン動作
- GitHub Pagesでのホスティング